<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PolySchema.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module.exports.html">exports</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#array">array</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#boolean">boolean</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#copy">copy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#enum">enum</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#function">function</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCondition">getCondition</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getName">getName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getSchema">getSchema</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getStrict">getStrict</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#instanceOf">instanceOf</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#merge">merge</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#null">null</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#number">number</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#object">object</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#pc">pc</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setStrict">setStrict</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#string">string</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#toString">toString</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#undefined">undefined</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#union">union</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validate">validate</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">PolySchema.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @file src/PolySchema.ts */
import PolyCondition from "./PolyCondition.js";
import PolyTypes from "./PolyTypes.js";
/**
 * Core library for PolySchema
 */
export default class PolySchema {
    /**
     * PolySchema constructor
     * @param name - Name of the schema
     * @param schema - Schema to validate against
     * @param strict - Use strict validation to check existence of certain keys (defaults to false)
     * @example
     * const schema = new PolySchema("Document Schema", { key: PolyTypes.string });
     */
    constructor(name, schema, strict = false) {
        this.name = name;
        this.schema = schema;
        this.strict = strict;
    }
    /**
     * Copy the current schema
     * @returns Copied schema
     * @example
     * schema.copy().validate({})
     */
    copy() {
        return new PolySchema(this.name, Object.assign({}, this.schema), this.strict);
    }
    /**
     * Merges another schema into the current schema; the new schema will override existing schema.
     * Use copy to create a new schema instead of modifying the original
     * @param schema - Schema to merge with current schema
     * @returns New merged schema
     * @example
     * schema.merge(new PolySchema("New Schema", { key: PolyTypes.string }))
     * @example
     * schema.merge({ key: PolyTypes.string })
     */
    merge(schema) {
        this.schema = Object.assign(Object.assign({}, this.schema), (schema instanceof PolySchema ? schema.getSchema() : schema));
        return this;
    }
    /**
     * Validate an object against the schema
     * @param object - Object to validate against the schema
     * @param verbose - Get errors (defaults to false)
     * @param strict - Override strict validation
     * @returns if verbose, returns true/false for valid/invalid; if not verbose, returns array of errors
     * @example
     * schema.validate({ key: "value" });
     */
    validate(object, verbose = false, strict = null) {
        strict = PolyTypes.null.getCondition()(strict) ? this.strict : strict;
        const errors = [];
        const main = (schema, value) => {
            // loop through values &amp; check if all props are added
            if (strict) {
                for (const [key, _] of Object.entries(value)) {
                    if (!(value.hasOwnProperty(key) &amp;&amp;
                        schema.hasOwnProperty(key))) {
                        errors.push(`${key} is not a valid property`);
                    }
                }
            }
            for (const [key, condition] of Object.entries(schema)) {
                // check if prop exists
                if (value.hasOwnProperty(key)) {
                    // allow for nested schemas
                    if (condition instanceof PolySchema) {
                        const errors = condition.validate(value[key], verbose, strict);
                        // add errors if necessary
                        if (errors &amp;&amp; Array.isArray(errors)) {
                            errors.forEach((error) => errors.push(error));
                        }
                    }
                    // check if prop is an object or if value matches condition
                    else if (PolyTypes.object.getCondition()(condition) &amp;&amp;
                        !(condition instanceof PolyCondition)) {
                        return main(schema[key], value[key]);
                    }
                    else if (!condition.getCondition()(value[key])) {
                        errors.push(`${key} of ${value[key]} is not a valid value for type ${condition.getName()}`);
                    }
                }
                else if (strict) {
                    errors.push(`${key} must be provided`);
                }
            }
            return errors;
        };
        if (PolyTypes.object.getCondition()(object)) {
            main(this.schema, object);
        }
        else {
            errors.push(`${object} is not a valid object, cannot check against schema`);
        }
        return verbose ? errors : errors.length === 0;
    }
    /**
     * Get the name of the schema
     * @returns Name of the schema
     */
    getName() {
        return this.name;
    }
    /**
     * Determine if the schema is in strict mode
     * @returns If schema is strict
     */
    getStrict() {
        return this.strict;
    }
    /**
     * Get the schema
     * @returns Schema
     */
    getSchema() {
        return this.schema;
    }
    /**
     * Set new strict mode
     * @param strict - New strict mode
     * @returns Current schema for chaining
     */
    setStrict(strict) {
        this.strict = strict;
        return this;
    }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Tue Aug 23 2022 20:17:54 GMT-0700 (Pacific Daylight Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
